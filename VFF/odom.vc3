{"editor":{"id":"d382f8e3-98ad-4c47-86d5-009490e7dd47","locked":true,"offsetX":-26,"offsetY":-16,"zoom":100,"gridSize":0,"layers":[{"id":"d9ea5933-0004-4f0d-a8c0-290a2c9849f2","type":"diagram-links","isSvg":true,"transformed":true,"models":{"9f5439d7-eda9-451a-8fd5-d4e3c4b4873d":{"id":"9f5439d7-eda9-451a-8fd5-d4e3c4b4873d","type":"default","selected":false,"source":"0005-1ef4ad68-5036-4b35-8f12-a38ac993841e","sourcePort":"1c2a5cab-315e-4e9e-b074-6b8ae69ebb57","target":"35184b04-b3a1-4e8e-919c-7be08de13f5c","targetPort":"99a2d344-53aa-40f6-a6af-0acbc01c2f15","points":[{"id":"74d8bdfd-7ad3-4a4e-bf91-04168177f845","type":"point","x":901,"y":140.5},{"id":"e1eb90a9-a14b-4d92-afb3-14fa69106a8c","type":"point","x":609.484375,"y":288.5}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"e450acce-6b4b-4cbc-8526-71fe9c1695b2":{"id":"e450acce-6b4b-4cbc-8526-71fe9c1695b2","type":"default","selected":false,"source":"35184b04-b3a1-4e8e-919c-7be08de13f5c","sourcePort":"ad11d04b-55c4-4a18-9bc0-6011a57e0439","target":"e3fca494-caff-4c97-a231-446ef5157eec","targetPort":"cb5318bf-f23b-4ae5-9a6b-1f24ad3b670e","points":[{"id":"f11546fc-a62a-454c-aa98-59f5d61a9d41","type":"point","x":790.46875,"y":461.5},{"id":"1fc1ef08-955d-42f5-b1c0-3c0ea2f981c5","type":"point","x":1576.5,"y":421.5}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"4e5f6948-0aa4-418d-802a-24d813d5b765":{"id":"4e5f6948-0aa4-418d-802a-24d813d5b765","type":"default","selected":false,"source":"35184b04-b3a1-4e8e-919c-7be08de13f5c","sourcePort":"1cc02e6c-2696-4510-b0d3-8c25e7bfaee4","target":"9642adda-63d5-4e10-b22a-f05baea64a25","targetPort":"0b717715-3582-41bc-9da8-ca64ef906f71","points":[{"id":"4e167928-2602-45c2-9b00-03bf35f54f5c","type":"point","x":428.5,"y":461.5},{"id":"2b6e667b-9f3a-4b3e-b6ee-87c98537aa1b","type":"point","x":388.5,"y":563.5}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"}}},{"id":"60dbdf23-d7e9-45a9-a943-4282f6ee3c51","type":"diagram-nodes","isSvg":false,"transformed":true,"models":{"9642adda-63d5-4e10-b22a-f05baea64a25":{"id":"9642adda-63d5-4e10-b22a-f05baea64a25","type":"basic.input","selected":false,"x":295,"y":537,"ports":[{"id":"0b717715-3582-41bc-9da8-ca64ef906f71","type":"port.output","x":381,"y":556,"name":"input-out","alignment":"right","parentNode":"9642adda-63d5-4e10-b22a-f05baea64a25","links":["4e5f6948-0aa4-418d-802a-24d813d5b765"],"in":false,"label":"Enable","hideLabel":true}],"data":{"name":"Enable"}},"0005-1ef4ad68-5036-4b35-8f12-a38ac993841e":{"id":"0005-1ef4ad68-5036-4b35-8f12-a38ac993841e","type":"basic.constant","selected":false,"x":840,"y":25,"ports":[{"id":"1c2a5cab-315e-4e9e-b074-6b8ae69ebb57","type":"port.output","x":893.5,"y":133,"name":"constant-out","alignment":"bottom","parentNode":"0005-1ef4ad68-5036-4b35-8f12-a38ac993841e","links":["9f5439d7-eda9-451a-8fd5-d4e3c4b4873d"],"in":false,"label":"ROSTopic","hideLabel":true}],"data":{"name":"ROSTopic","value":"/odom","local":true}},"e3fca494-caff-4c97-a231-446ef5157eec":{"id":"e3fca494-caff-4c97-a231-446ef5157eec","type":"basic.output","selected":false,"x":1568,"y":395,"ports":[{"id":"cb5318bf-f23b-4ae5-9a6b-1f24ad3b670e","type":"port.input","x":1569,"y":414,"name":"output-in","alignment":"left","parentNode":"e3fca494-caff-4c97-a231-446ef5157eec","links":["e450acce-6b4b-4cbc-8526-71fe9c1695b2"],"in":true,"label":"output-in","hideLabel":true}],"data":{"name":"Odom"}},"35184b04-b3a1-4e8e-919c-7be08de13f5c":{"id":"35184b04-b3a1-4e8e-919c-7be08de13f5c","type":"basic.code","selected":true,"x":419,"y":210,"ports":[{"id":"1cc02e6c-2696-4510-b0d3-8c25e7bfaee4","type":"port.input","x":421,"y":454,"name":"Enable","alignment":"left","parentNode":"35184b04-b3a1-4e8e-919c-7be08de13f5c","links":["4e5f6948-0aa4-418d-802a-24d813d5b765"],"in":true,"label":"Enable","hideLabel":false},{"id":"ad11d04b-55c4-4a18-9bc0-6011a57e0439","type":"port.output","x":782.96875,"y":454,"name":"Odom","alignment":"right","parentNode":"35184b04-b3a1-4e8e-919c-7be08de13f5c","links":["e450acce-6b4b-4cbc-8526-71fe9c1695b2"],"in":false,"label":"Odom","hideLabel":false},{"id":"99a2d344-53aa-40f6-a6af-0acbc01c2f15","type":"port.parameter","x":601.984375,"y":281,"name":"ROSTopic","alignment":"top","parentNode":"35184b04-b3a1-4e8e-919c-7be08de13f5c","links":["9f5439d7-eda9-451a-8fd5-d4e3c4b4873d"],"in":true,"label":"ROSTopic","hideLabel":false}],"data":{"code":"#!/usr/bin/env python3\n\nimport pandas as pd\nimport numpy as np\nimport rclpy\nfrom rclpy.node import Node\nfrom cv_bridge import CvBridge\nfrom nav_msgs.msg import Odometry\nfrom scipy.spatial.transform import Rotation\n\nbridge = CvBridge()\nodom = [0,0,0]\n\n# ros2 node class\nclass OdometerSubscriber(Node):\n\n    def __init__(self, topic):\n\n        super().__init__('odometer_subscriber')\n\n        self.subscription = self.create_subscription(\n            Odometry, topic, self.callback, 10)\n\n        self.subscription  # prevent unused variable warning\n\n\n    def callback(self, msg):\n\n        global odom\n        odom[0] = msg.pose.pose.position.x\n        odom[1] = msg.pose.pose.position.y\n        rot = Rotation.from_quat([msg.pose.pose.orientation.x, msg.pose.pose.orientation.y, msg.pose.pose.orientation.z, msg.pose.pose.orientation.w])\n        rot_euler = rot.as_euler('xyz', degrees=True)\n        print(\"ROT -> \" + rot.shape)\n        print(\"ROTE-> \" + rot_euler.shape)\n\n        euler_df = pd.DataFrame(rot_euler, columns=['x', 'y', 'z'])\n        odom[2] = euler_df[2]\n\ndef main(inputs, outputs, parameters, synchronise):\n    \n    global odom\n\n    auto_enable = False\n    try:\n        enable = inputs.read_number('Enable')\n    except Exception:\n        auto_enable = True\n\n    rclpy.init()\n    odom_subscriber = OdometerSubscriber(parameters.read_string(\"ROSTopic\"))\n\n    try:\n        while auto_enable or inputs.read_number('Enable'):\n            measure = None\n            rclpy.spin_once(odom_subscriber)\n\n            if measure is not None:\n                print(\"ODOM -> \" + odom)\n                outputs.share_number(\"X-Y-Yaw\",odom)\n\n            synchronise()  \n    except Exception as e:\n        print('Error:', e)\n        pass\n    finally:\n        print(\"Exiting\")\n        synchronise()     \n        odom_subscriber.destroy_node()\n        rclpy.shutdown()\n","frequency":"30","params":[{"name":"ROSTopic"}],"ports":{"in":[{"name":"Enable"}],"out":[{"name":"Odom"}]},"size":{"width":"300px","height":"300px"}}}}}]},"version":"3.0","package":{"name":"Odometer","version":"2.0.0","description":"Returns a Pose Message with the Robot's Position","author":"Muhammad Taha Suhail, Toshan Luktuke","image":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJDYXBhXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMzY4IDM2OCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMzY4IDM2ODsiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHBhdGggc3R5bGU9ImZpbGw6I0NDRTRGRjsiIGQ9Ik0xODQsOGM5Ny4yLDAsMTc2LDc4LjgsMTc2LDE3NnMtNzguOCwxNzYtMTc2LDE3NlM4LDI4MS4yLDgsMTg0Uzg2LjgsOCwxODQsOHogTTI5NC44OCwyNDgNCgljMTAuODgtMTguOCwxNy4xMi00MC42NCwxNy4xMi02NGMwLTcwLjcyLTU3LjI4LTEyOC0xMjgtMTI4UzU2LDExMy4yOCw1NiwxODRjMCwyMy4zNiw2LjI0LDQ1LjIsMTcuMTIsNjQNCgljMjIuMDgsMzguMjQsNjMuNTIsNjQsMTEwLjg4LDY0UzI3Mi44LDI4Ni4yNCwyOTQuODgsMjQ4eiIvPg0KPGc+DQoJPHBhdGggc3R5bGU9ImZpbGw6IzAwN0FGRjsiIGQ9Ik0xODQsMEM4Mi41NDQsMCwwLDgyLjU0NCwwLDE4NHM4Mi41NDQsMTg0LDE4NCwxODRzMTg0LTgyLjU0NCwxODQtMTg0UzI4NS40NTYsMCwxODQsMHogTTE4NCwzNTINCgkJYy05Mi42NCwwLTE2OC03NS4zNi0xNjgtMTY4UzkxLjM2LDE2LDE4NCwxNnMxNjgsNzUuMzYsMTY4LDE2OFMyNzYuNjQsMzUyLDE4NCwzNTJ6Ii8+DQoJPHBhdGggc3R5bGU9ImZpbGw6IzAwN0FGRjsiIGQ9Ik0yODAuMTM2LDg3Ljg2NGMtMC4wMzItMC4wMzItMC4wOC0wLjA0LTAuMTEyLTAuMDcyQzI1NS40MDgsNjMuMjE2LDIyMS40NDgsNDgsMTg0LDQ4DQoJCXMtNzEuNDA4LDE1LjIxNi05Ni4wMjQsMzkuNzg0Yy0wLjAzMiwwLjAzMi0wLjA4LDAuMDQtMC4xMTIsMC4wNzJzLTAuMDQsMC4wOC0wLjA3MiwwLjExMkM2My4yMTYsMTEyLjU5Miw0OCwxNDYuNTUyLDQ4LDE4NA0KCQljMCwyMy45Miw2LjI4OCw0Ny40MjQsMTguMTg0LDY3Ljk4NGMwLDAuMDA4LDAsMC4wMTYsMC4wMDgsMC4wMTZjMjQuMjE2LDQxLjk0NCw2OS4zNiw2OCwxMTcuODA4LDY4czkzLjU5Mi0yNi4wNTYsMTE3LjgwOC02OA0KCQljMC0wLjAwOCwwLTAuMDE2LDAuMDA4LTAuMDE2QzMxMy43MTIsMjMxLjQyNCwzMjAsMjA3LjkyLDMyMCwxODRjMC0zNy40NDgtMTUuMjE2LTcxLjQwOC0zOS43ODQtOTYuMDI0DQoJCUMyODAuMTc2LDg3Ljk0NCwyODAuMTY4LDg3Ljg5NiwyODAuMTM2LDg3Ljg2NHogTTI2NCwxOTJoMzkuNTEyYy0xLjEyLDE2Ljc5Mi01LjUyOCwzMy4xOTItMTMuMzUyLDQ4SDc3LjgzMg0KCQljLTcuODI0LTE0LjgwOC0xMi4yMzItMzEuMjA4LTEzLjM1Mi00OEgxMDRjNC40MTYsMCw4LTMuNTg0LDgtOHMtMy41ODQtOC04LThINjQuNDA4YzEuOC0yNy4wNjQsMTIuNTUyLTUxLjY1NiwyOS4zOTItNzAuODg4DQoJCWwyNy45ODQsMjcuOTg0YzEuNTYsMS41NiwzLjYwOCwyLjM0NCw1LjY1NiwyLjM0NHM0LjA5Ni0wLjc4NCw1LjY1Ni0yLjM0NGMzLjEyOC0zLjEyOCwzLjEyOC04LjE4NCwwLTExLjMxMkwxMDUuMTEyLDkzLjgNCgkJQzEyNC4zNDQsNzYuOTYsMTQ4LjkzNiw2Ni4yLDE3Niw2NC40MDhWMTA0YzAsNC40MTYsMy41ODQsOCw4LDhzOC0zLjU4NCw4LThWNjQuNDA4YzI3LjA2NCwxLjgsNTEuNjU2LDEyLjU1Miw3MC44ODgsMjkuMzkyDQoJCWwtNjguNiw2OC42Yy0zLjE2OC0xLjUyLTYuNjQtMi40LTEwLjI4OC0yLjRjLTEzLjIzMiwwLTI0LDEwLjc2OC0yNCwyNHMxMC43NjgsMjQsMjQsMjRzMjQtMTAuNzY4LDI0LTI0DQoJCWMwLTMuNjY0LTAuODg4LTcuMTQ0LTIuMzkyLTEwLjI5Nmw2OC41OTItNjguNTkyYzE2Ljg0LDE5LjIzMiwyNy42LDQzLjgyNCwyOS4zOTIsNzAuODg4SDI2NGMtNC40MTYsMC04LDMuNTg0LTgsOA0KCQlDMjU2LDE4OC40MTYsMjU5LjU4NCwxOTIsMjY0LDE5MnogTTE3OC4wODgsMTg5LjI3MmMtMC41OTItMC42NjQtMS4xMi0xLjM3Ni0xLjQ2NC0yLjIwOA0KCQlDMTc2Ljk1MiwxODcuODY0LDE3Ny40OCwxODguNTkyLDE3OC4wODgsMTg5LjI3MnogTTE3Ni42MTYsMTgwLjkzNmMwLjM0NC0wLjgzMiwwLjg4LTEuNTQ0LDEuNDY0LTIuMjA4DQoJCUMxNzcuNDgsMTc5LjQwOCwxNzYuOTUyLDE4MC4xMzYsMTc2LjYxNiwxODAuOTM2eiBNMTgwLjkzNiwxOTEuMzg0Yy0wLjgzMi0wLjM0NC0xLjU0NC0wLjg4LTIuMjA4LTEuNDY0DQoJCUMxNzkuNDA4LDE5MC41MiwxODAuMTM2LDE5MS4wNDgsMTgwLjkzNiwxOTEuMzg0eiBNMTg5LjI3MiwxODkuOTEyYy0wLjY2NCwwLjU5Mi0xLjM3NiwxLjEyLTIuMjA4LDEuNDY0DQoJCUMxODcuODY0LDE5MS4wNDgsMTg4LjU5MiwxOTAuNTIsMTg5LjI3MiwxODkuOTEyeiBNMTg0LDMwNGMtMzcuOTA0LDAtNzMuNDg4LTE4LjEwNC05NS45NjgtNDhoMTkxLjkzNg0KCQlDMjU3LjQ4OCwyODUuODk2LDIyMS45MDQsMzA0LDE4NCwzMDR6Ii8+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8L3N2Zz4NCg=="},"design":{"board":"Python3-Noetic","graph":{"blocks":[{"id":"9642adda-63d5-4e10-b22a-f05baea64a25","type":"basic.input","data":{"name":"Enable"},"position":{"x":295,"y":537}},{"id":"0005-1ef4ad68-5036-4b35-8f12-a38ac993841e","type":"basic.constant","data":{"name":"ROSTopic","value":"/odom","local":true},"position":{"x":840,"y":25}},{"id":"e3fca494-caff-4c97-a231-446ef5157eec","type":"basic.output","data":{"name":"Odom"},"position":{"x":1568,"y":395}},{"id":"35184b04-b3a1-4e8e-919c-7be08de13f5c","type":"basic.code","data":{"code":"#!/usr/bin/env python3\n\nimport pandas as pd\nimport numpy as np\nimport rclpy\nfrom rclpy.node import Node\nfrom cv_bridge import CvBridge\nfrom nav_msgs.msg import Odometry\nfrom scipy.spatial.transform import Rotation\n\nbridge = CvBridge()\nodom = [0,0,0]\n\n# ros2 node class\nclass OdometerSubscriber(Node):\n\n    def __init__(self, topic):\n\n        super().__init__('odometer_subscriber')\n\n        self.subscription = self.create_subscription(\n            Odometry, topic, self.callback, 10)\n\n        self.subscription  # prevent unused variable warning\n\n\n    def callback(self, msg):\n\n        global odom\n        odom[0] = msg.pose.pose.position.x\n        odom[1] = msg.pose.pose.position.y\n        rot = Rotation.from_quat([msg.pose.pose.orientation.x, msg.pose.pose.orientation.y, msg.pose.pose.orientation.z, msg.pose.pose.orientation.w])\n        rot_euler = rot.as_euler('xyz', degrees=True)\n        print(\"ROT -> \" + rot.shape)\n        print(\"ROTE-> \" + rot_euler.shape)\n\n        euler_df = pd.DataFrame(rot_euler, columns=['x', 'y', 'z'])\n        odom[2] = euler_df[2]\n\ndef main(inputs, outputs, parameters, synchronise):\n    \n    global odom\n\n    auto_enable = False\n    try:\n        enable = inputs.read_number('Enable')\n    except Exception:\n        auto_enable = True\n\n    rclpy.init()\n    odom_subscriber = OdometerSubscriber(parameters.read_string(\"ROSTopic\"))\n\n    try:\n        while auto_enable or inputs.read_number('Enable'):\n            measure = None\n            rclpy.spin_once(odom_subscriber)\n\n            if measure is not None:\n                print(\"ODOM -> \" + odom)\n                outputs.share_number(\"X-Y-Yaw\",odom)\n\n            synchronise()  \n    except Exception as e:\n        print('Error:', e)\n        pass\n    finally:\n        print(\"Exiting\")\n        synchronise()     \n        odom_subscriber.destroy_node()\n        rclpy.shutdown()\n","frequency":"30","params":[{"name":"ROSTopic"}],"ports":{"in":[{"name":"Enable"}],"out":[{"name":"Odom"}]},"size":{"width":"300px","height":"300px"}},"position":{"x":419,"y":210}}],"wires":[{"source":{"block":"0005-1ef4ad68-5036-4b35-8f12-a38ac993841e","port":"constant-out","name":"ROSTopic"},"target":{"block":"35184b04-b3a1-4e8e-919c-7be08de13f5c","port":"ROSTopic","name":"ROSTopic"}},{"source":{"block":"35184b04-b3a1-4e8e-919c-7be08de13f5c","port":"Odom","name":"Odom"},"target":{"block":"e3fca494-caff-4c97-a231-446ef5157eec","port":"output-in","name":"output-in"}},{"source":{"block":"9642adda-63d5-4e10-b22a-f05baea64a25","port":"input-out","name":"Enable"},"target":{"block":"35184b04-b3a1-4e8e-919c-7be08de13f5c","port":"Enable","name":"Enable"}}]}},"dependencies":{}}