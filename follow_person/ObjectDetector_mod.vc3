{"editor":{"id":"61f178bc-18a3-44f6-b9f2-819321aca469","locked":true,"offsetX":21,"offsetY":-56,"zoom":100,"gridSize":0,"layers":[{"id":"f198d948-42b5-4cc2-8b11-fe072af4deeb","type":"diagram-links","isSvg":true,"transformed":true,"models":{"8ca305f5-7cea-4c91-bd7e-0ff4cc87eedb":{"id":"8ca305f5-7cea-4c91-bd7e-0ff4cc87eedb","type":"default","selected":false,"source":"3a59c566-ea5a-4f28-9523-004c754cdac9","sourcePort":"ba78b537-d107-4f76-97e0-82759a3d6346","target":"2915186e-9674-4fef-a81c-fd520d0a5428","targetPort":"db24c4f4-c4e5-4582-a6c1-a2ed77c75f3a","points":[{"id":"e16a753e-83ee-4a1a-9e43-c99a2c410660","type":"point","x":377.5,"y":416.5},{"id":"96452aa7-303f-40d3-ae41-ce6bb3563ae6","type":"point","x":437.5,"y":287.828125}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"2acadca4-5c6f-4ba0-9bc5-bfe4521e4cf2":{"id":"2acadca4-5c6f-4ba0-9bc5-bfe4521e4cf2","type":"default","selected":false,"source":"3680762a-e4d0-4a2f-8315-22db96c2f120","sourcePort":"a29a2c0d-b3fc-40a6-842c-1f5d96080b9d","target":"2915186e-9674-4fef-a81c-fd520d0a5428","targetPort":"17c7b261-0a21-4b5a-824a-5244df64ee85","points":[{"id":"34866d0b-10bd-4265-a152-5810ce01bd70","type":"point","x":385.5,"y":620.5},{"id":"0a4de0b2-52c3-4ced-a7db-29bc03704741","type":"point","x":437.5,"y":403.15625}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"a31c6d73-4e14-4779-a25a-8c626f22037c":{"id":"a31c6d73-4e14-4779-a25a-8c626f22037c","type":"default","selected":false,"source":"2915186e-9674-4fef-a81c-fd520d0a5428","sourcePort":"43b67277-86c6-4a5f-88d1-eddd4b402074","target":"fdde5749-5980-4f30-9ae9-b488600d3b38","targetPort":"2d0347f8-274a-43f0-9dcd-0d26e8187fc2","points":[{"id":"8dde4eef-55b5-44d1-b168-ec72b66b4008","type":"point","x":1261.390625,"y":403.15625},{"id":"8f0dccac-b65d-4a25-b46d-29060b8fe821","type":"point","x":1361.5,"y":601.5}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"75db0c83-ac0c-4a75-8709-4fee02a3cb98":{"id":"75db0c83-ac0c-4a75-8709-4fee02a3cb98","type":"default","selected":false,"source":"2915186e-9674-4fef-a81c-fd520d0a5428","sourcePort":"559d7b32-8861-4daa-80f6-c9a81ea7867d","target":"0284379d-f0d9-4099-a08b-15cdb9c65fbc","targetPort":"222a1a1a-aa77-41e7-a440-30f9c700f7ef","points":[{"id":"bdcc5ffe-8f6d-4cdb-8fd1-d70190647ce4","type":"point","x":1261.390625,"y":287.828125},{"id":"6972b4e5-708a-48ac-9818-cd1d557456f6","type":"point","x":1343.5,"y":416.5}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"}}},{"id":"099b6333-8ae3-4c4a-a3eb-d861374a1159","type":"diagram-nodes","isSvg":false,"transformed":true,"models":{"3680762a-e4d0-4a2f-8315-22db96c2f120":{"id":"3680762a-e4d0-4a2f-8315-22db96c2f120","type":"basic.input","selected":false,"x":292,"y":594,"ports":[{"id":"a29a2c0d-b3fc-40a6-842c-1f5d96080b9d","type":"port.output","x":378,"y":613,"name":"input-out","alignment":"right","parentNode":"3680762a-e4d0-4a2f-8315-22db96c2f120","links":["2acadca4-5c6f-4ba0-9bc5-bfe4521e4cf2"],"in":false,"label":"Enable","hideLabel":true}],"data":{"name":"Enable"}},"2915186e-9674-4fef-a81c-fd520d0a5428":{"id":"2915186e-9674-4fef-a81c-fd520d0a5428","type":"basic.code","selected":false,"x":429,"y":121,"ports":[{"id":"db24c4f4-c4e5-4582-a6c1-a2ed77c75f3a","type":"port.input","x":430,"y":280.328125,"name":"Img IN","alignment":"left","parentNode":"2915186e-9674-4fef-a81c-fd520d0a5428","links":["8ca305f5-7cea-4c91-bd7e-0ff4cc87eedb"],"in":true,"label":"Img IN","hideLabel":false},{"id":"17c7b261-0a21-4b5a-824a-5244df64ee85","type":"port.input","x":430,"y":395.65625,"name":"Enable","alignment":"left","parentNode":"2915186e-9674-4fef-a81c-fd520d0a5428","links":["2acadca4-5c6f-4ba0-9bc5-bfe4521e4cf2"],"in":true,"label":"Enable","hideLabel":false},{"id":"559d7b32-8861-4daa-80f6-c9a81ea7867d","type":"port.output","x":1253.890625,"y":280.328125,"name":"Img OUT","alignment":"right","parentNode":"2915186e-9674-4fef-a81c-fd520d0a5428","links":["75db0c83-ac0c-4a75-8709-4fee02a3cb98"],"in":false,"label":"Img OUT","hideLabel":false},{"id":"43b67277-86c6-4a5f-88d1-eddd4b402074","type":"port.output","x":1253.890625,"y":395.65625,"name":"Results","alignment":"right","parentNode":"2915186e-9674-4fef-a81c-fd520d0a5428","links":["a31c6d73-4e14-4779-a25a-8c626f22037c"],"in":false,"label":"Results","hideLabel":false}],"data":{"code":"import cv2\nimport numpy as np\nimport time\n\nclassName = []\nclassesFile = 'utils/models/yolov3/yolov3.txt'\n\nwith open(classesFile,'rt') as f:\n    className = f.read().rstrip('\\n').split('\\n')\n\ndef findObjects(outputs, img):\n\n    confThreshold = 0.3\n    nmsThreshold = 0.3\n    hT, wT, cT = img.shape\n    bbox = []\n    classIds = []\n    confs = []\n\n    for output in outputs:\n    \n        for det in output:\n            scores = det[5:]\n            classId = np.argmax(scores)\n            confidence = scores[classId]\n            if confidence > confThreshold:\n                w,h = int(det[2] * wT), int(det[3] * hT)\n                x,y = int((det[0]*wT) - w/2), int((det[1]*hT) - h/2)\n                bbox.append([x,y,w,h])\n                classIds.append(classId)\n                confs.append(float(confidence))\n    \n    indices = cv2.dnn.NMSBoxes(bbox, confs, confThreshold, nmsThreshold)\n    \n    for i in range(len(indices)):\n        box = bbox[i]\n        x,y,w,h = box[0],box[1],box[2],box[3]\n        cv2.rectangle(img,(x,y),(x+w, y+h),(255,0,255),2)\n        cv2.putText(img,f'{className[classIds[i]].upper()} {int(confs[i]*100)}%',\n                    (x,y-10),cv2.FONT_HERSHEY_SIMPLEX, 0.6, (255,0,255),2)\n           \ndef main(inputs, outputs, parameters, synchronise):\n    auto_enable = True\n    try:\n        enable = inputs.read_number(\"Enable\")\n    except Exception:\n        auto_enable = True\n    \n    whT = 320\n\n    modelConfiguration = 'utils/models/yolov3/yolov3-tiny.cfg'\n    modelWeights = 'utils/models/yolov3/yolov3-tiny.weights'\n\n    net = cv2.dnn.readNetFromDarknet(modelConfiguration,modelWeights)\n    net.setPreferableBackend(cv2.dnn.DNN_BACKEND_OPENCV)\n    net.setPreferableTarget(cv2.dnn.DNN_TARGET_CPU)\n\n    while(auto_enable or inputs.read_number('Enable')):\n        frame = inputs.read_image(\"Img IN\")\n        \n        if frame is None:\n            continue\n\n        #converting img to blob\n        blob = cv2.dnn.blobFromImage(frame, 1/255,(whT,whT),[0,0,0],1, crop = False)\n\n        #Passing blob to network\n        net.setInput(blob)\n\n        layerNames = net.getLayerNames()\n        outputNames = []\n        outLayers = net.getUnconnectedOutLayers()\n        \n        for i in range(len(outLayers)):\n            outputNames.append(layerNames[outLayers[i] - 1])\n\n        #forward Pass\n        results = net.forward(outputNames)\n        findObjects(results,frame)\n\n        print(\"results -> \")\n        print(results)\n\n        \n        outputs.share_image(\"Img OUT\", frame)\n        outputs.share_array(\"Results\", results)\n","frequency":"30","params":[],"ports":{"in":[{"name":"Img IN"},{"name":"Enable"}],"out":[{"name":"Img OUT"},{"name":"Results"}]},"size":{"width":"750px","height":"300px"}}},"3a59c566-ea5a-4f28-9523-004c754cdac9":{"id":"3a59c566-ea5a-4f28-9523-004c754cdac9","type":"basic.input","selected":false,"x":284,"y":390,"ports":[{"id":"ba78b537-d107-4f76-97e0-82759a3d6346","type":"port.output","x":370,"y":409,"name":"input-out","alignment":"right","parentNode":"3a59c566-ea5a-4f28-9523-004c754cdac9","links":["8ca305f5-7cea-4c91-bd7e-0ff4cc87eedb"],"in":false,"label":"Img IN","hideLabel":true}],"data":{"name":"Img IN"}},"0284379d-f0d9-4099-a08b-15cdb9c65fbc":{"id":"0284379d-f0d9-4099-a08b-15cdb9c65fbc","type":"basic.output","selected":false,"x":1335,"y":390,"ports":[{"id":"222a1a1a-aa77-41e7-a440-30f9c700f7ef","type":"port.input","x":1336,"y":409,"name":"output-in","alignment":"left","parentNode":"0284379d-f0d9-4099-a08b-15cdb9c65fbc","links":["75db0c83-ac0c-4a75-8709-4fee02a3cb98"],"in":true,"label":"output-in","hideLabel":true}],"data":{"name":"Img OUT"}},"fdde5749-5980-4f30-9ae9-b488600d3b38":{"id":"fdde5749-5980-4f30-9ae9-b488600d3b38","type":"basic.output","selected":true,"x":1352,"y":574,"ports":[{"id":"2d0347f8-274a-43f0-9dcd-0d26e8187fc2","type":"port.input","x":1354,"y":594,"name":"output-in","alignment":"left","parentNode":"fdde5749-5980-4f30-9ae9-b488600d3b38","links":["a31c6d73-4e14-4779-a25a-8c626f22037c"],"in":true,"label":"output-in","hideLabel":true}],"data":{"name":"Results"}}}}]},"version":"3.0","package":{"name":"ObjectDetector","version":"2.0.0","description":"Detects Objects in an Image","author":"Faizan Ahmed","image":"data:image/svg+xml;base64,PHN2ZyBpZD0iQ2FwYV8xIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA1MTAgNTEwIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMCA1MTAiIHdpZHRoPSI1MTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgaWQ9IlhNTElEXzI3MF8iPjxwYXRoIGlkPSJYTUxJRF8zOTdfIiBkPSJtMjQwIDB2NzUuNjJsNy41IDYuMjk3IDcuNS02LjkxNyAzLjY3My0zNi4xMDYtMy42NzMtMzguODk0Yy01LjI0NiAwLTkuNzU0IDAtMTUgMHoiIGZpbGw9IiNlNjM5NTAiLz48cGF0aCBpZD0iWE1MSURfMzYxXyIgZD0ibTI3MCAwYy01LjI0NiAwLTkuNzU0IDAtMTUgMHY3NWw3LjUgNi45MTYgNy41LTYuMjk3YzAtMTguOTg5IDAtNjMuNDM2IDAtNzUuNjE5eiIgZmlsbD0iI2NkMDAwMCIvPjxwYXRoIGlkPSJYTUxJRF8zNThfIiBkPSJtMjQwIDQzNC4zNzh2NzUuNjIyaDE1bDUuODMzLTM1LjMzMy01LjgzMy0zOS42NjctNy41LTcuNjY3eiIgZmlsbD0iI2U2Mzk1MCIvPjxwYXRoIGlkPSJYTUxJRF8zNTVfIiBkPSJtMjcwIDQzNC4zNzgtNy41LTcuMDQ1LTcuNSA3LjY2N3Y3NWgxNWMwLTEyLjAwOSAwLTU2LjYzMiAwLTc1LjYyMnoiIGZpbGw9IiNjZDAwMDAiLz48cGF0aCBpZD0iWE1MSURfMzUyXyIgZD0ibTQzNC4zODEgMjcwaDc1LjYxOWMwLTEwLjQ5MiAwLTE5LjUwOCAwLTMwLTEyLjAwOSAwLTU2LjYyOSAwLTc1LjYxOSAwbC0xNC4zODEgMTV6IiBmaWxsPSIjY2QwMDAwIi8+PHBhdGggaWQ9IlhNTElEXzM0OV8iIGQ9Im03NS42MjIgMjcwYy0xOC45OSAwLTYzLjQzOSAwLTc1LjYyMiAwIDAtMTAuNDkyIDAtMTkuNTA4IDAtMzBoNzUuNjIxbDE0LjM3OSAxNXoiIGZpbGw9IiNlNjM5NTAiLz48cGF0aCBpZD0iWE1MSURfMzQ1XyIgZD0ibTc1IDI1NWMwIDk5LjI1IDgwLjc0NSAxODAgMTgwIDE4MGwxNS0xODAtMTUtMTgwYy05OS4yNSAwLTE4MCA4MC43NDUtMTgwIDE4MHoiIGZpbGw9IiNmZjYzN2IiLz48cGF0aCBpZD0iWE1MSURfMzQyXyIgZD0ibTQzNSAyNTVjMC05OS4yNDktODAuNzQ1LTE4MC0xODAtMTgwdjM2MGM5OS4yNDkgMCAxODAtODAuNzQ1IDE4MC0xODB6IiBmaWxsPSIjZTYzOTUwIi8+PHBhdGggaWQ9IlhNTElEXzMyN18iIGQ9Im0xMDUgMjU1YzAgODIuNzA3IDY3LjI4NyAxNTAgMTUwIDE1MGwxNS0xNTAtMTUtMTUwYy04Mi43MDggMC0xNTAgNjcuMjg3LTE1MCAxNTB6IiBmaWxsPSIjZTZmMmZmIi8+PHBhdGggaWQ9IlhNTElEXzMyM18iIGQ9Im00MDUgMjU1YzAtODIuNzA4LTY3LjI4Ny0xNTAtMTUwLTE1MHYzMDBjODIuNzA3IDAgMTUwLTY3LjI4OCAxNTAtMTUweiIgZmlsbD0iI2NkZiIvPjxwYXRoIGlkPSJYTUxJRF8zMjBfIiBkPSJtNDgwIDMwdjkwaDMwYzAtMTQuNTE4IDAtMTA1LjM4NiAwLTEyMC0xNC41MTggMC0xMDUuMzg2IDAtMTIwIDB2MzB6IiBmaWxsPSIjY2RmIi8+PHBhdGggaWQ9IlhNTElEXzMxNV8iIGQ9Im0zMCAxMjBjLTEwLjQ5MiAwLTE5LjUwOCAwLTMwIDAgMC0xNC41MTggMC0xMDUuMzg2IDAtMTIwaDEyMHYzMGMtMTAuODg5IDAtNzkuMDQgMC05MCAweiIgZmlsbD0iI2U2ZjJmZiIvPjxwYXRoIGlkPSJYTUxJRF8zMTJfIiBkPSJtNDgwIDQ4MGMtMTAuODg5IDAtNzkuMDQgMC05MCAwdjMwaDEyMGMwLTE0LjUxOCAwLTEwNS4zODYgMC0xMjAtMTAuNDkyIDAtMTkuNTA4IDAtMzAgMHoiIGZpbGw9IiNjZGYiLz48cGF0aCBpZD0iWE1MSURfMzA5XyIgZD0ibTEyMCA1MTBjLTE0LjUxOCAwLTEwNS4zODYgMC0xMjAgMCAwLTE0LjUxOCAwLTEwNS4zODYgMC0xMjBoMzB2OTBoOTB6IiBmaWxsPSIjZTZmMmZmIi8+PHBhdGggaWQ9IlhNTElEXzMwMF8iIGQ9Im0yMTMuNjc3IDIzNC44MjRjLTE0LjUwNSA3LjIwNi0yNC43NDYgMTYuNzItMzEuOTU0IDI2LjIwMi0xNC4zNzkgMTguOTE0LTE2LjY5MSAzNy42OTgtMTYuNzIzIDM3Ljc2NnYzMS4yMDhoOTBsMTUtMzcuNTAxLTE1LTM3LjUwMXoiIGZpbGw9IiM2Y2YiLz48cGF0aCBpZD0iWE1MSURfMjk2XyIgZD0ibTM0NSAyOTguNzkyYy0uMTAzLS4yMjQtMi4wMzQtMTguOTI3LTE2LjU1NS0zNy44NzEtNy4xODgtOS4zNzctMTcuNDYtMTguODEzLTMyLjEyMi0yNi4wOTZsLTQxLjMyMyAyMC4xNzN2MzcuNTAxIDM3LjUwMWg5MGMwLTEwLjkxNSAwLTIwLjI5MyAwLTMxLjIwOHoiIGZpbGw9IiM0NTk2ZTYiLz48cGF0aCBpZD0iWE1MSURfMjkyXyIgZD0ibTIwMi41IDIwMi41YzAgMjguOTQ4IDIzLjU1IDUyLjUgNTIuNSA1Mi41bDE1LTUyLjUtMTUtNTIuNWMtMjguOTQ4IDAtNTIuNSAyMy41NS01Mi41IDUyLjV6IiBmaWxsPSIjZmRjIi8+PHBhdGggaWQ9IlhNTElEXzI4N18iIGQ9Im0zMDcuNSAyMDIuNWMwLTI4Ljk0Ny0yMy41NS01Mi41LTUyLjUtNTIuNXYxMDVjMjguOTQ3IDAgNTIuNS0yMy41NSA1Mi41LTUyLjV6IiBmaWxsPSIjZmZiZmIzIi8+PC9nPjwvc3ZnPg=="},"design":{"board":"Python3-Noetic","graph":{"blocks":[{"id":"3680762a-e4d0-4a2f-8315-22db96c2f120","type":"basic.input","data":{"name":"Enable"},"position":{"x":292,"y":594}},{"id":"2915186e-9674-4fef-a81c-fd520d0a5428","type":"basic.code","data":{"code":"import cv2\nimport numpy as np\nimport time\n\nclassName = []\nclassesFile = 'utils/models/yolov3/yolov3.txt'\n\nwith open(classesFile,'rt') as f:\n    className = f.read().rstrip('\\n').split('\\n')\n\ndef findObjects(outputs, img):\n\n    confThreshold = 0.3\n    nmsThreshold = 0.3\n    hT, wT, cT = img.shape\n    bbox = []\n    classIds = []\n    confs = []\n\n    for output in outputs:\n    \n        for det in output:\n            scores = det[5:]\n            classId = np.argmax(scores)\n            confidence = scores[classId]\n            if confidence > confThreshold:\n                w,h = int(det[2] * wT), int(det[3] * hT)\n                x,y = int((det[0]*wT) - w/2), int((det[1]*hT) - h/2)\n                bbox.append([x,y,w,h])\n                classIds.append(classId)\n                confs.append(float(confidence))\n    \n    indices = cv2.dnn.NMSBoxes(bbox, confs, confThreshold, nmsThreshold)\n    \n    for i in range(len(indices)):\n        box = bbox[i]\n        x,y,w,h = box[0],box[1],box[2],box[3]\n        cv2.rectangle(img,(x,y),(x+w, y+h),(255,0,255),2)\n        cv2.putText(img,f'{className[classIds[i]].upper()} {int(confs[i]*100)}%',\n                    (x,y-10),cv2.FONT_HERSHEY_SIMPLEX, 0.6, (255,0,255),2)\n           \ndef main(inputs, outputs, parameters, synchronise):\n    auto_enable = True\n    try:\n        enable = inputs.read_number(\"Enable\")\n    except Exception:\n        auto_enable = True\n    \n    whT = 320\n\n    modelConfiguration = 'utils/models/yolov3/yolov3-tiny.cfg'\n    modelWeights = 'utils/models/yolov3/yolov3-tiny.weights'\n\n    net = cv2.dnn.readNetFromDarknet(modelConfiguration,modelWeights)\n    net.setPreferableBackend(cv2.dnn.DNN_BACKEND_OPENCV)\n    net.setPreferableTarget(cv2.dnn.DNN_TARGET_CPU)\n\n    while(auto_enable or inputs.read_number('Enable')):\n        frame = inputs.read_image(\"Img IN\")\n        \n        if frame is None:\n            continue\n\n        #converting img to blob\n        blob = cv2.dnn.blobFromImage(frame, 1/255,(whT,whT),[0,0,0],1, crop = False)\n\n        #Passing blob to network\n        net.setInput(blob)\n\n        layerNames = net.getLayerNames()\n        outputNames = []\n        outLayers = net.getUnconnectedOutLayers()\n        \n        for i in range(len(outLayers)):\n            outputNames.append(layerNames[outLayers[i] - 1])\n\n        #forward Pass\n        results = net.forward(outputNames)\n        findObjects(results,frame)\n\n        print(\"results -> \")\n        print(results)\n\n        \n        outputs.share_image(\"Img OUT\", frame)\n        outputs.share_array(\"Results\", results)\n","frequency":"30","params":[],"ports":{"in":[{"name":"Img IN"},{"name":"Enable"}],"out":[{"name":"Img OUT"},{"name":"Results"}]},"size":{"width":"750px","height":"300px"}},"position":{"x":429,"y":121}},{"id":"3a59c566-ea5a-4f28-9523-004c754cdac9","type":"basic.input","data":{"name":"Img IN"},"position":{"x":284,"y":390}},{"id":"0284379d-f0d9-4099-a08b-15cdb9c65fbc","type":"basic.output","data":{"name":"Img OUT"},"position":{"x":1335,"y":390}},{"id":"fdde5749-5980-4f30-9ae9-b488600d3b38","type":"basic.output","data":{"name":"Results"},"position":{"x":1352,"y":574}}],"wires":[{"source":{"block":"3a59c566-ea5a-4f28-9523-004c754cdac9","port":"input-out","name":"Img IN"},"target":{"block":"2915186e-9674-4fef-a81c-fd520d0a5428","port":"Img IN","name":"Img IN"}},{"source":{"block":"3680762a-e4d0-4a2f-8315-22db96c2f120","port":"input-out","name":"Enable"},"target":{"block":"2915186e-9674-4fef-a81c-fd520d0a5428","port":"Enable","name":"Enable"}},{"source":{"block":"2915186e-9674-4fef-a81c-fd520d0a5428","port":"Results","name":"Results"},"target":{"block":"fdde5749-5980-4f30-9ae9-b488600d3b38","port":"output-in","name":"output-in"}},{"source":{"block":"2915186e-9674-4fef-a81c-fd520d0a5428","port":"Img OUT","name":"Img OUT"},"target":{"block":"0284379d-f0d9-4099-a08b-15cdb9c65fbc","port":"output-in","name":"output-in"}}]}},"dependencies":{}}