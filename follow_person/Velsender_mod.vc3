{"editor":{"id":"bb24521a-8c41-4f55-8e96-b7aff41c4297","locked":false,"offsetX":204.0583261154189,"offsetY":171.3802606306197,"zoom":86.74999999999993,"gridSize":0,"layers":[{"id":"50937002-f39a-4d49-a9eb-39771635497f","type":"diagram-links","isSvg":true,"transformed":true,"models":{"f8e43bb9-37c4-4408-a680-571c030d72d9":{"id":"f8e43bb9-37c4-4408-a680-571c030d72d9","type":"default","selected":false,"source":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","sourcePort":"e8bfadb2-2491-4166-907b-e09181babdca","target":"0002-cb4c125e-14b6-4322-b252-35d2817b2832","targetPort":"c76ea7fc-9390-4252-bcaa-01bd0afe7bfd","points":[{"id":"8db435da-3b4b-41ae-a042-0c8c1d1c0f9c","type":"point","x":708.2655943891971,"y":122.15625843079694},{"id":"cc60d6cc-491c-4489-b456-e71a0004eead","type":"point","x":707.0781000177993,"y":-21.12499332814141}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"a19ec3bb-0b17-4310-8e30-fd0865f83bae":{"id":"a19ec3bb-0b17-4310-8e30-fd0865f83bae","type":"default","selected":false,"source":"a0f07e9e-bd5e-4295-a3a2-5690fa4568ba","sourcePort":"a23d135a-c5ad-4eac-8978-9c8fdae27da3","target":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","targetPort":"8591ce9d-3607-4aa6-9a4f-d268b857f659","points":[{"id":"e242894f-bd3f-4208-83a5-7727aaf1aa34","type":"point","x":188.49998346070242,"y":258.50000280219473},{"id":"8afe35a1-97b1-41a3-a2fc-987ac89a947a","type":"point","x":401.28123768215426,"y":282.4062598379477}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"832b6309-b33a-4a4f-a639-95fec9b18444":{"id":"832b6309-b33a-4a4f-a639-95fec9b18444","type":"default","selected":false,"source":"c7109ac4-0435-4164-9969-4e8c9132a156","sourcePort":"1d737e56-99e3-4eb6-93ef-9c4826582708","target":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","targetPort":"c547bd32-8a9c-4281-b1bc-f374d7f5ce89","points":[{"id":"df57641a-187c-40a4-b839-004907f59ee1","type":"point","x":177.20577078959298,"y":390.308975779275},{"id":"7349ddd5-8e3c-4555-8505-108357902aa4","type":"point","x":401.28123768215426,"y":442.6562436557162}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"7c5374cc-7975-4284-9646-82852a5b1e0d":{"id":"7c5374cc-7975-4284-9646-82852a5b1e0d","type":"default","selected":false,"source":"78669ed1-e751-4ec8-ae57-b87a640feb4b","sourcePort":"80c09fc1-951c-412b-8395-f298f56faf68","target":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","targetPort":"621b0dfb-69e6-4d72-97b2-8a90159f7c88","points":[{"id":"cb709cfe-7b7e-4087-b56d-6fc22491eca9","type":"point","x":191.3437468286329,"y":568.5312802416313},{"id":"c7f38e67-dad0-43f7-a4d6-52f520fe4bdd","type":"point","x":401.28123768215426,"y":602.9062802416313}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"}}},{"id":"220b70ae-199a-4bc2-8a5d-05e7ec6ae5ca","type":"diagram-nodes","isSvg":false,"transformed":true,"models":{"0002-cb4c125e-14b6-4322-b252-35d2817b2832":{"id":"0002-cb4c125e-14b6-4322-b252-35d2817b2832","type":"basic.constant","selected":false,"x":646.0893371757925,"y":-136.63688760806923,"ports":[{"id":"c76ea7fc-9390-4252-bcaa-01bd0afe7bfd","type":"port.output","x":699.5780929820464,"y":-28.624991569203196,"name":"constant-out","alignment":"bottom","parentNode":"0002-cb4c125e-14b6-4322-b252-35d2817b2832","links":["f8e43bb9-37c4-4408-a680-571c030d72d9"],"in":false,"label":"constant-out","hideLabel":true}],"data":{"name":"ROS Topic","value":"/cmd_vel","local":true}},"a0f07e9e-bd5e-4295-a3a2-5690fa4568ba":{"id":"a0f07e9e-bd5e-4295-a3a2-5690fa4568ba","type":"basic.input","selected":false,"x":95,"y":232,"ports":[{"id":"a23d135a-c5ad-4eac-8978-9c8fdae27da3","type":"port.output","x":180.99997642494955,"y":251.00001335582405,"name":"input-out","alignment":"right","parentNode":"a0f07e9e-bd5e-4295-a3a2-5690fa4568ba","links":["a19ec3bb-0b17-4310-8e30-fd0865f83bae"],"in":false,"label":"Vels","hideLabel":true}],"data":{"name":"Vels1"}},"78669ed1-e751-4ec8-ae57-b87a640feb4b":{"id":"78669ed1-e751-4ec8-ae57-b87a640feb4b","type":"basic.input","selected":false,"x":97.84726224783861,"y":542.034582132565,"ports":[{"id":"80c09fc1-951c-412b-8395-f298f56faf68","type":"port.output","x":183.84375738226223,"y":561.0312732058784,"name":"input-out","alignment":"right","parentNode":"78669ed1-e751-4ec8-ae57-b87a640feb4b","links":["7c5374cc-7975-4284-9646-82852a5b1e0d"],"in":false,"label":"Enable","hideLabel":true}],"data":{"name":"Enable"}},"b64b1d4c-3949-45ad-acf5-e2c30349dc54":{"id":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","type":"basic.code","selected":false,"x":392.79538904899175,"y":44.66858789625355,"ports":[{"id":"8591ce9d-3607-4aa6-9a4f-d268b857f659","type":"port.input","x":393.7812658251658,"y":274.906270391577,"name":"Vels1","alignment":"left","parentNode":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","links":["a19ec3bb-0b17-4310-8e30-fd0865f83bae"],"in":true,"label":"Vels1","hideLabel":false},{"id":"c547bd32-8a9c-4281-b1bc-f374d7f5ce89","type":"port.input","x":393.7812658251658,"y":435.1562366199633,"name":"Vels2","alignment":"left","parentNode":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","links":["832b6309-b33a-4a4f-a639-95fec9b18444"],"in":true,"label":"Vels2","hideLabel":false},{"id":"621b0dfb-69e6-4d72-97b2-8a90159f7c88","type":"port.input","x":393.7812658251658,"y":595.4062732058784,"name":"Enable","alignment":"left","parentNode":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","links":["7c5374cc-7975-4284-9646-82852a5b1e0d"],"in":true,"label":"Enable","hideLabel":false},{"id":"e8bfadb2-2491-4166-907b-e09181babdca","type":"port.parameter","x":700.7655873534442,"y":114.65626898442625,"name":"ROSTopic","alignment":"top","parentNode":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","links":["f8e43bb9-37c4-4408-a680-571c030d72d9"],"in":true,"label":"ROSTopic","hideLabel":false}],"data":{"code":"#!/usr/bin/env python3\n\nimport numpy as np\n\nimport rclpy\nfrom rclpy.node import Node\nfrom cv_bridge import CvBridge\nfrom geometry_msgs.msg import Twist\n\nbridge = CvBridge()\nvelocities = 0\n\n# ros2 node class\nclass VelPublisher(Node):\n\n    def __init__(self, topic):\n        super().__init__('vel_publisher')\n        self.publisher_ = self.create_publisher(Twist, topic, 1)\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n\n    def timer_callback(self):\n        global velocities\n        msg = Twist()\n        \n        try:\n            msg.linear.x = float(velocities[0])\n            msg.linear.y = float(velocities[1])\n            msg.linear.z = float(velocities[2])\n            msg.angular.x = float(velocities[3])\n            msg.angular.y = float(velocities[4])\n            msg.angular.z = float(velocities[5])\n        except IndexError:\n            print(\"bad length for input array\")\n            return\n        self.publisher_.publish(msg)\n\n\n\ndef main(inputs, outputs, parameters, synchronise):\n    \n    global velocities\n\n    auto_enable = False\n    try:\n        enable = inputs.read_number('Enable')\n    except Exception:\n        auto_enable = True\n\n    rclpy.init()\n    vel_publisher = VelPublisher(parameters.read_string('ROS Topic'))\n\n    try:\n\n        while auto_enable or inputs.read_number('Enable'):\n\n            velocities1 = inputs.read_array('Vels1')\n            velocities2 = inputs.read_array('Vels2')\n            if velocities1 != None:\n                rclpy.spin_once(vel_publisher) \n            synchronise()   \n    \n    except KeyboardInterrupt:\n\n        vel_publisher.destroy_node()\n        rclpy.shutdown()\n","frequency":"30","params":[{"name":"ROSTopic"}],"ports":{"in":[{"name":"Vels1"},{"name":"Vels2"},{"name":"Enable"}],"out":[]},"size":{"width":"300px","height":"300px"}}},"c7109ac4-0435-4164-9969-4e8c9132a156":{"id":"c7109ac4-0435-4164-9969-4e8c9132a156","type":"basic.input","selected":true,"x":82.70893371757924,"y":362.8242074927956,"ports":[{"id":"1d737e56-99e3-4eb6-93ef-9c4826582708","type":"port.output","x":169.70576375384007,"y":382.80896874352226,"name":"input-out","alignment":"right","parentNode":"c7109ac4-0435-4164-9969-4e8c9132a156","links":["832b6309-b33a-4a4f-a639-95fec9b18444"],"in":false,"label":"Vels2","hideLabel":true}],"data":{"name":"Vels2"}}}}]},"version":"3.0","package":{"name":"ROS2MotorDriver","version":"1.0.0","description":"Controls Robot's Movement using ROS2.","author":"David Tapiador de Vera","image":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB2aWV3Qm94PSIwIDAgMTI4IDEyOCIgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiPjx0aXRsZT5NT1RPUiBEQzwvdGl0bGU+PHBhdGggZD0iTTU0LjQ2OSwzNC42MjVINzQuNjNhNy4yOTQsNy4yOTQsMCwwLDEsNy4yOTQsNy4yOTRWNTJhMCwwLDAsMCwxLDAsMEg0Ny4xNzVhMCwwLDAsMCwxLDAsMFY0MS45MTlBNy4yOTQsNy4yOTQsMCwwLDEsNTQuNDY5LDM0LjYyNVoiIHN0eWxlPSJmaWxsOiNiYWRkZmEiLz48cGF0aCBkPSJNODAuNDI1LDUySDQ4LjY3NVY3Mi4xOTFBNC4wNzYsNC4wNzYsMCwwLDAsNTEuMyw3NmgwYTQuMDc2LDQuMDc2LDAsMCwxLDIuNjI1LDMuODA5VjgwLjVoMjEuMjV2LS42OTFBNC4wNzYsNC4wNzYsMCwwLDEsNzcuOCw3NmgwYTQuMDc2LDQuMDc2LDAsMCwwLDIuNjI1LTMuODA5WiIgc3R5bGU9ImZpbGw6I2ZmZiIvPjxyZWN0IHg9IjYxLjExMiIgeT0iODYuNSIgd2lkdGg9IjYuODc1IiBoZWlnaHQ9IjYuODc1IiBzdHlsZT0iZmlsbDojYmFkZGZhIi8+PHBhdGggZD0iTTc0LjYzLDMzLjUyNUg1NC40NjlhOC40LDguNCwwLDAsMC04LjM5NCw4LjM5NVY1MmExLjEsMS4xLDAsMCwwLDEuMSwxLjFoLjRWNzIuMTkxYTUuMjA2LDUuMjA2LDAsMCwwLDMuMzMzLDQuODM3LDIuOTkxLDIuOTkxLDAsMCwxLDEuOTE2LDIuNzhWODAuNWExLjEsMS4xLDAsMCwwLDEuMSwxLjFINjMuNDV2My44SDYxLjExMmExLjEsMS4xLDAsMCwwLTEuMSwxLjF2Ni44NzVhMS4xLDEuMSwwLDAsMCwxLjEsMS4xaDYuODc1YTEuMSwxLjEsMCwwLDAsMS4xLTEuMVY4Ni41YTEuMSwxLjEsMCwwLDAtMS4xLTEuMUg2NS42NVY4MS42aDkuNTI1YTEuMSwxLjEsMCwwLDAsMS4xLTEuMXYtLjY5MWEyLjk5MSwyLjk5MSwwLDAsMSwxLjkxNi0yLjc4LDUuMjA2LDUuMjA2LDAsMCwwLDMuMzMzLTQuODM3VjUzLjFoLjRhMS4xLDEuMSwwLDAsMCwxLjEtMS4xVjQxLjkyQTguNCw4LjQsMCwwLDAsNzQuNjMsMzMuNTI1Wm0tNy43NDMsNTguNzVINjIuMjEyVjg3LjZoNC42NzVaTTQ4LjI3NSw0MS45MmE2LjIsNi4yLDAsMCwxLDYuMTk0LTYuMkg3NC42M2E2LjIsNi4yLDAsMCwxLDYuMTk0LDYuMlY1MC45SDQ4LjI3NVptMzEuMDUsMzAuMjcyYTIuOTkxLDIuOTkxLDAsMCwxLTEuOTE2LDIuNzhBNS4yMSw1LjIxLDAsMCwwLDc0LjA5MSw3OS40SDU1LjAwOGE1LjIxLDUuMjEsMCwwLDAtMy4zMTctNC40MjksMi45OTEsMi45OTEsMCwwLDEtMS45MTYtMi43OFY1My4xaDI5LjU1WiIgc3R5bGU9ImZpbGw6IzM5NDlhYSIvPjxwYXRoIGQ9Ik01Ny44LDcxLjZhMS4xLDEuMSwwLDAsMCwxLjEtMS4xVjU4Ljc1YTEuMSwxLjEsMCwwLDAtMi4yLDBWNzAuNUExLjEsMS4xLDAsMCwwLDU3LjgsNzEuNloiIHN0eWxlPSJmaWxsOiMzOTQ5YWEiLz48cGF0aCBkPSJNNjQuNTUsNzEuNmExLjEsMS4xLDAsMCwwLDEuMS0xLjFWNTguNzVhMS4xLDEuMSwwLDAsMC0yLjIsMFY3MC41QTEuMSwxLjEsMCwwLDAsNjQuNTUsNzEuNloiIHN0eWxlPSJmaWxsOiMzOTQ5YWEiLz48cGF0aCBkPSJNNzEuMyw3MS42YTEuMSwxLjEsMCwwLDAsMS4xLTEuMVY1OC43NWExLjEsMS4xLDAsMCwwLTIuMiwwVjcwLjVBMS4xLDEuMSwwLDAsMCw3MS4zLDcxLjZaIiBzdHlsZT0iZmlsbDojMzk0OWFhIi8+PC9zdmc+Cg=="},"design":{"board":"Python3-Noetic","graph":{"blocks":[{"id":"0002-cb4c125e-14b6-4322-b252-35d2817b2832","type":"basic.constant","data":{"name":"ROS Topic","value":"/cmd_vel","local":true},"position":{"x":646.0893371757925,"y":-136.63688760806923}},{"id":"a0f07e9e-bd5e-4295-a3a2-5690fa4568ba","type":"basic.input","data":{"name":"Vels1"},"position":{"x":95,"y":232}},{"id":"78669ed1-e751-4ec8-ae57-b87a640feb4b","type":"basic.input","data":{"name":"Enable"},"position":{"x":97.84726224783861,"y":542.034582132565}},{"id":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","type":"basic.code","data":{"code":"#!/usr/bin/env python3\n\nimport numpy as np\n\nimport rclpy\nfrom rclpy.node import Node\nfrom cv_bridge import CvBridge\nfrom geometry_msgs.msg import Twist\n\nbridge = CvBridge()\nvelocities = 0\n\n# ros2 node class\nclass VelPublisher(Node):\n\n    def __init__(self, topic):\n        super().__init__('vel_publisher')\n        self.publisher_ = self.create_publisher(Twist, topic, 1)\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n\n    def timer_callback(self):\n        global velocities\n        msg = Twist()\n        \n        try:\n            msg.linear.x = float(velocities[0])\n            msg.linear.y = float(velocities[1])\n            msg.linear.z = float(velocities[2])\n            msg.angular.x = float(velocities[3])\n            msg.angular.y = float(velocities[4])\n            msg.angular.z = float(velocities[5])\n        except IndexError:\n            print(\"bad length for input array\")\n            return\n        self.publisher_.publish(msg)\n\n\n\ndef main(inputs, outputs, parameters, synchronise):\n    \n    global velocities\n\n    auto_enable = False\n    try:\n        enable = inputs.read_number('Enable')\n    except Exception:\n        auto_enable = True\n\n    rclpy.init()\n    vel_publisher = VelPublisher(parameters.read_string('ROS Topic'))\n\n    try:\n\n        while auto_enable or inputs.read_number('Enable'):\n\n            velocities1 = inputs.read_array('Vels1')\n            velocities2 = inputs.read_array('Vels2')\n            if velocities1 != None:\n                rclpy.spin_once(vel_publisher) \n            synchronise()   \n    \n    except KeyboardInterrupt:\n\n        vel_publisher.destroy_node()\n        rclpy.shutdown()\n","frequency":"30","params":[{"name":"ROSTopic"}],"ports":{"in":[{"name":"Vels1"},{"name":"Vels2"},{"name":"Enable"}],"out":[]},"size":{"width":"300px","height":"300px"}},"position":{"x":392.79538904899175,"y":44.66858789625355}},{"id":"c7109ac4-0435-4164-9969-4e8c9132a156","type":"basic.input","data":{"name":"Vels2"},"position":{"x":82.70893371757924,"y":362.8242074927956}}],"wires":[{"source":{"block":"0002-cb4c125e-14b6-4322-b252-35d2817b2832","port":"constant-out","name":"constant-out"},"target":{"block":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","port":"ROSTopic","name":"ROSTopic"}},{"source":{"block":"a0f07e9e-bd5e-4295-a3a2-5690fa4568ba","port":"input-out","name":"Vels"},"target":{"block":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","port":"Vels1","name":"Vels1"}},{"source":{"block":"c7109ac4-0435-4164-9969-4e8c9132a156","port":"input-out","name":"Vels2"},"target":{"block":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","port":"Vels2","name":"Vels2"}},{"source":{"block":"78669ed1-e751-4ec8-ae57-b87a640feb4b","port":"input-out","name":"Enable"},"target":{"block":"b64b1d4c-3949-45ad-acf5-e2c30349dc54","port":"Enable","name":"Enable"}}]}},"dependencies":{}}