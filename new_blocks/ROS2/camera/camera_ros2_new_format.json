{"editor":{"id":"d6210a0f-a225-4555-8f64-e7db042b2dd4","locked":true,"offsetX":213.5410616653349,"offsetY":-13.418566127480984,"zoom":77.03333333333326,"gridSize":0,"layers":[{"id":"3effa9a6-1264-4118-ac6f-021d90c8bf3e","type":"diagram-links","isSvg":true,"transformed":true,"models":{"0d0daede-8557-4d51-bd10-9642966fc206":{"id":"0d0daede-8557-4d51-bd10-9642966fc206","type":"default","selected":false,"source":"c7816a42-b545-4c5f-a55e-e186d62c71ef","sourcePort":"77ff14e0-6424-44ef-949e-8c723d9e0aac","target":"2dd64f43-ee2d-4caf-a8f5-c671333426e7","targetPort":"ce290b0d-75c5-4af2-bbb9-c05aeaa4e405","points":[{"id":"24f2266f-b883-4115-ade1-b61cd6949399","type":"point","x":193.49999189258386,"y":126.49999277133386},{"id":"36567f3c-703a-4ca8-a9b3-c1c75fa5b0fa","type":"point","x":286.50000029119053,"y":322.999991028227}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"1ffacd20-c4e1-417d-9b3b-18308d085613":{"id":"1ffacd20-c4e1-417d-9b3b-18308d085613","type":"default","selected":false,"source":"0008-3c24ef3a-5e27-491d-9535-740b05bf5e65","sourcePort":"dbf975b2-5e12-4d68-b20b-68a591608f20","target":"2dd64f43-ee2d-4caf-a8f5-c671333426e7","targetPort":"2c8db0d0-6ddf-4a58-839e-4eaa4d9e9755","points":[{"id":"509d8adb-229d-4743-856c-006703088e68","type":"point","x":790.0000073164405,"y":166.50000043044048},{"id":"7291d62c-9227-4c4f-9784-63018eef3f21","type":"point","x":706.0312542527978,"y":290.49997861519216}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"fcdf07cd-75cb-4759-bf01-3e96dfd44127":{"id":"fcdf07cd-75cb-4759-bf01-3e96dfd44127","type":"default","selected":false,"source":"2dd64f43-ee2d-4caf-a8f5-c671333426e7","sourcePort":"9203a038-fa54-40da-b1a6-6f05a5b7d6ac","target":"244c4582-cc4c-4633-859b-02b91bfe0b8a","targetPort":"9a296e0b-b6b2-4ee7-8fb3-6a4ef5de5569","points":[{"id":"b9868c30-4ae0-4dd5-9854-a2b102bf5f79","type":"point","x":1125.59378510051,"y":322.999991028227},{"id":"a36433c7-7a4a-4e2f-bea0-023b71ca25d9","type":"point","x":1299.6093469260863,"y":236.5781218649944}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"}}},{"id":"5390ba84-5213-4882-9a31-594a3e8d08cf","type":"diagram-nodes","isSvg":false,"transformed":true,"models":{"0008-3c24ef3a-5e27-491d-9535-740b05bf5e65":{"id":"0008-3c24ef3a-5e27-491d-9535-740b05bf5e65","type":"basic.constant","selected":false,"x":729,"y":51,"ports":[{"id":"dbf975b2-5e12-4d68-b20b-68a591608f20","type":"port.output","x":782.5000120703687,"y":159.00000518436872,"name":"constant-out","alignment":"bottom","parentNode":"0008-3c24ef3a-5e27-491d-9535-740b05bf5e65","links":["1ffacd20-c4e1-417d-9b3b-18308d085613"],"in":false,"label":"constant-out","hideLabel":true}],"data":{"name":"ROS Topic","value":"/depth_camera/image_raw","local":true}},"2dd64f43-ee2d-4caf-a8f5-c671333426e7":{"id":"2dd64f43-ee2d-4caf-a8f5-c671333426e7","type":"basic.code","selected":false,"x":278,"y":213,"ports":[{"id":"ce290b0d-75c5-4af2-bbb9-c05aeaa4e405","type":"port.input","x":278.99998523708445,"y":315.49997597412096,"name":"Enable","alignment":"left","parentNode":"2dd64f43-ee2d-4caf-a8f5-c671333426e7","links":["0d0daede-8557-4d51-bd10-9642966fc206"],"in":true,"label":"Enable","hideLabel":false},{"id":"9203a038-fa54-40da-b1a6-6f05a5b7d6ac","type":"port.output","x":1118.09375023837,"y":315.49997597412096,"name":"Img","alignment":"right","parentNode":"2dd64f43-ee2d-4caf-a8f5-c671333426e7","links":["fcdf07cd-75cb-4759-bf01-3e96dfd44127"],"in":false,"label":"Img","hideLabel":false},{"id":"2c8db0d0-6ddf-4a58-839e-4eaa4d9e9755","type":"port.parameter","x":698.5312193906575,"y":282.9999833691204,"name":"ROS Topic","alignment":"top","parentNode":"2dd64f43-ee2d-4caf-a8f5-c671333426e7","links":["1ffacd20-c4e1-417d-9b3b-18308d085613"],"in":true,"label":"ROS Topic","hideLabel":false}],"data":{"code":"#!/usr/bin/env python3\n\nimport numpy as np\nimport rclpy\nfrom rclpy.node import Node\nfrom cv_bridge import CvBridge\nfrom sensor_msgs.msg import Image\n\nbridge = CvBridge()\nframe = None\n\n# ros2 node class\nclass CamSubscriber(Node):\n \n    def __init__(self, topic):\n\n        super().__init__('cam_subscriber')\n        self.subscription = self.create_subscription(\n            Image, topic, self.callback, 10)\n\n        self.subscription  # prevent unused variable warning\n\n\n    def callback(self, msg):\n\n        global frame\n        frame = np.asarray(bridge.imgmsg_to_cv2(msg, \"bgr8\"), dtype=np.uint8)\n\n\n\ndef main(inputs, outputs, parameters, synchronise):\n    global frame\n\n    auto_enable = False\n    try:\n        enable = inputs.read_number('Enable')\n    except Exception:\n        auto_enable = True\n\n    rclpy.init()\n    camera_subscriber = CamSubscriber(parameters.read_string(\"ROS Topic\"))\n\n    try:\n        while auto_enable or inputs.read_number('Enable'):\n            frame =  None\n            rclpy.spin_once(camera_subscriber)\n\n            if frame is not None:\n                outputs.share_image(\"Img\", frame)\n\n            synchronise()\n    except Exception as e:\n        print('Error:', e)\n        pass\n    finally:\n        print(\"Exiting\")\n        synchronise()     \n        camera_subscriber.destroy_node()\n        rclpy.shutdown()\n","frequency":"30","params":[{"name":"ROS Topic"}],"ports":{"in":[{"name":"Enable"}],"out":[{"name":"Img"}]},"size":{"width":"787px","height":"19px"}}},"c7816a42-b545-4c5f-a55e-e186d62c71ef":{"id":"c7816a42-b545-4c5f-a55e-e186d62c71ef","type":"basic.input","x":100,"y":100,"ports":[{"id":"77ff14e0-6424-44ef-949e-8c723d9e0aac","type":"port.output","x":185.9999966465121,"y":118.99999752526209,"name":"input-out","alignment":"right","parentNode":"c7816a42-b545-4c5f-a55e-e186d62c71ef","links":["0d0daede-8557-4d51-bd10-9642966fc206"],"in":false,"label":"Enable","hideLabel":true}],"data":{"name":"Enable"}},"244c4582-cc4c-4633-859b-02b91bfe0b8a":{"id":"244c4582-cc4c-4633-859b-02b91bfe0b8a","type":"basic.output","selected":true,"x":1290.118563392471,"y":209.08697533535266,"ports":[{"id":"9a296e0b-b6b2-4ee7-8fb3-6a4ef5de5569","type":"port.input","x":1292.1093912960832,"y":229.07811671490546,"name":"output-in","alignment":"left","parentNode":"244c4582-cc4c-4633-859b-02b91bfe0b8a","links":["fcdf07cd-75cb-4759-bf01-3e96dfd44127"],"in":true,"label":"output-in","hideLabel":true}],"data":{"name":"Img"}}}}]},"version":"3.0","package":{"name":"","version":"","description":"","author":"","image":""},"design":{"board":"Python3-Noetic","graph":{"blocks":[{"id":"0008-3c24ef3a-5e27-491d-9535-740b05bf5e65","type":"basic.constant","data":{"name":"ROS Topic","value":"/depth_camera/image_raw","local":true},"position":{"x":729,"y":51}},{"id":"2dd64f43-ee2d-4caf-a8f5-c671333426e7","type":"basic.code","data":{"code":"#!/usr/bin/env python3\n\nimport numpy as np\nimport rclpy\nfrom rclpy.node import Node\nfrom cv_bridge import CvBridge\nfrom sensor_msgs.msg import Image\n\nbridge = CvBridge()\nframe = None\n\n# ros2 node class\nclass CamSubscriber(Node):\n \n    def __init__(self, topic):\n\n        super().__init__('cam_subscriber')\n        self.subscription = self.create_subscription(\n            Image, topic, self.callback, 10)\n\n        self.subscription  # prevent unused variable warning\n\n\n    def callback(self, msg):\n\n        global frame\n        frame = np.asarray(bridge.imgmsg_to_cv2(msg, \"bgr8\"), dtype=np.uint8)\n\n\n\ndef main(inputs, outputs, parameters, synchronise):\n    global frame\n\n    auto_enable = False\n    try:\n        enable = inputs.read_number('Enable')\n    except Exception:\n        auto_enable = True\n\n    rclpy.init()\n    camera_subscriber = CamSubscriber(parameters.read_string(\"ROS Topic\"))\n\n    try:\n        while auto_enable or inputs.read_number('Enable'):\n            frame =  None\n            rclpy.spin_once(camera_subscriber)\n\n            if frame is not None:\n                outputs.share_image(\"Img\", frame)\n\n            synchronise()\n    except Exception as e:\n        print('Error:', e)\n        pass\n    finally:\n        print(\"Exiting\")\n        synchronise()     \n        camera_subscriber.destroy_node()\n        rclpy.shutdown()\n","frequency":"30","params":[{"name":"ROS Topic"}],"ports":{"in":[{"name":"Enable"}],"out":[{"name":"Img"}]},"size":{"width":"787px","height":"19px"}},"position":{"x":278,"y":213}},{"id":"c7816a42-b545-4c5f-a55e-e186d62c71ef","type":"basic.input","data":{"name":"Enable"},"position":{"x":100,"y":100}},{"id":"244c4582-cc4c-4633-859b-02b91bfe0b8a","type":"basic.output","data":{"name":"Img"},"position":{"x":1290.118563392471,"y":209.08697533535266}}],"wires":[{"source":{"block":"c7816a42-b545-4c5f-a55e-e186d62c71ef","port":"input-out","name":"Enable"},"target":{"block":"2dd64f43-ee2d-4caf-a8f5-c671333426e7","port":"Enable","name":"Enable"}},{"source":{"block":"0008-3c24ef3a-5e27-491d-9535-740b05bf5e65","port":"constant-out","name":"constant-out"},"target":{"block":"2dd64f43-ee2d-4caf-a8f5-c671333426e7","port":"ROS Topic","name":"ROS Topic"}},{"source":{"block":"2dd64f43-ee2d-4caf-a8f5-c671333426e7","port":"Img","name":"Img"},"target":{"block":"244c4582-cc4c-4633-859b-02b91bfe0b8a","port":"output-in","name":"output-in"}}]}},"dependencies":{}}